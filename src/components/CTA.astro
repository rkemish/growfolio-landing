---
// CTA section with waitlist form
---

<section id="waitlist" class="cta-gradient py-24 lg:py-32 px-6 lg:px-10 text-center">
  <div class="max-w-3xl mx-auto relative z-10">
    <h2
      class="reveal font-display text-3xl md:text-4xl lg:text-5xl font-semibold mb-6"
      style="color: var(--color-cream);"
    >
      Be the First to Build<br />Your Family's Future
    </h2>
    <p class="reveal text-xl mb-10" style="color: rgba(255, 255, 255, 0.8);">
      Join the waitlist for early access. We're launching soon in Spain, Germany, France, and the
      Netherlands.
    </p>

    <form id="waitlist-form" class="reveal flex flex-col sm:flex-row gap-4 max-w-lg mx-auto">
      <input
        type="email"
        name="email"
        placeholder="Enter your email"
        required
        class="flex-1 px-6 py-4 rounded-full text-base font-medium border-none outline-none focus:ring-2"
        style="background: white; color: var(--color-forest);"
      />
      <button
        type="submit"
        class="btn px-8 py-4 shrink-0"
        style="background: var(--color-gold); color: var(--color-forest);"
      >
        Join Waitlist
      </button>
    </form>

    <p class="reveal text-sm mt-4" style="color: rgba(255, 255, 255, 0.6);">
      No spam. Just updates on our launch.
    </p>
  </div>
</section>

<script>
  const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyFXlrs7fdGbFJs2wMH1jGXNRoY-_F7zayBuHDGq-veJwLtqewlYKTGmHLouri6eHLE/exec';

  const form = document.getElementById('waitlist-form');
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const button = form.querySelector('button') as HTMLButtonElement;
      const email = new FormData(form as HTMLFormElement).get('email');
      const originalText = button.textContent;

      button.textContent = 'Joining...';
      button.disabled = true;

      try {
        const res = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ email }),
        });

        const data = await res.json();

        if (data.success) {
          button.textContent = "You're on the list!";
          button.style.background = 'var(--color-teal)';
          (form as HTMLFormElement).reset();
        } else if (data.error === 'Already registered') {
          button.textContent = 'Already signed up!';
        } else {
          button.textContent = 'Error - Try again';
        }
      } catch (err) {
        button.textContent = 'Error - Try again';
      }

      setTimeout(() => {
        button.textContent = originalText;
        button.style.background = 'var(--color-gold)';
        button.disabled = false;
      }, 3000);
    });
  }
</script>
